<<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cyber Network Flow — Single File (SVG Map)</title>

  <!-- ========================================================
       Single-file application: all HTML, CSS and JS in here.
       - All sections are full-screen "pages" inside one file.
       - The world map is an SVG globe made from an equirectangular
         rectangle clipped to a circle; markers are plotted by lat/lon.
       - Flow: Loader → Connected → Confirm → Upload → Success (map)
       ========================================================= -->

  <style>
  /* =======================================================
     THEME VARIABLES
     Bright neon green on black with glows; change these to
     customize the look quickly.
     ======================================================= */
  :root{
    --neon: #00ff66;
    --bg: #000000;
    --panel: rgba(10,10,10,0.6);
    --muted: rgba(0,255,102,0.07);
    --glass: rgba(255,255,255,0.02);
    --glow-strong: 0 0 18px rgba(0,255,102,0.18), 0 0 40px rgba(0,255,102,0.06);
    --glow-soft: 0 0 10px rgba(0,255,102,0.08);
    --font: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  }

  /* =======================================================
     Reset and base layout
     ======================================================= */
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;width:100%;background:var(--bg);font-family:var(--font);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
  body{display:flex;align-items:center;justify-content:center;padding:22px}

  /* root app container */
  .app {
    width: min(1100px, 98%);
    max-width: 1200px;
    min-height: 640px;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.006));
    border-radius: 14px;
    border: 1px solid rgba(0,255,102,0.04);
    box-shadow: 0 10px 60px rgba(0,0,0,0.65), var(--glow-strong);
    position: relative;
    overflow: hidden;
    display: grid;
    grid-template-rows: auto 1fr;
  }

  /* decorative background grid and radial glow */
  .bg-grid {
    position:absolute;inset:0;z-index:0;pointer-events:none;
    background:
      repeating-linear-gradient(0deg, rgba(0,255,102,0.06) 0px, rgba(0,255,102,0.06) 1px, transparent 1px, transparent 24px),
      repeating-linear-gradient(90deg, rgba(0,255,102,0.06) 0px, rgba(0,255,102,0.06) 1px, transparent 1px, transparent 24px);
    animation: gridMove 18s linear infinite; opacity:0.72; filter: blur(1px);
  }
  @keyframes gridMove{from{background-position:0 0,0 0}to{background-position:60px 60px,60px 60px}}
  .bg-rad{position:absolute;inset:-20%;z-index:0;pointer-events:none;background:
         radial-gradient(circle at 18% 32%, rgba(0,255,102,0.05), transparent 12%),
         radial-gradient(circle at 78% 72%, rgba(0,255,102,0.03), transparent 18%);filter:blur(28px)}

  /* header row */
  .topbar {
    z-index:2;padding:12px 18px;display:flex;align-items:center;justify-content:space-between;gap:12px;
    border-bottom:1px solid rgba(0,255,102,0.02);
    background:linear-gradient(180deg, rgba(0,0,0,0.02), rgba(0,0,0,0.06));
  }
  .brand {display:flex;align-items:center;gap:12px;color:var(--neon);font-weight:800}
  .brand .logo{width:44px;height:44px;border-radius:8px;background:linear-gradient(90deg,#002a08,#003f10);display:grid;place-items:center;font-weight:900;color:var(--neon)}
  .mutedSmall{color:rgba(0,255,102,0.12);font-size:12px}

  /* main content area (below header) */
  .main {
    display:grid;grid-template-columns: 1fr 380px;gap:18px;padding:22px;z-index:2;
    align-items:start;
  }

  /* left big visual pane (where loader, map, etc live) */
  .leftPane {
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.14));
    border-radius:10px;padding:20px;border:1px solid rgba(0,255,102,0.02);
    min-height:520px;display:flex;align-items:center;justify-content:center;position:relative;
  }

  /* right controls/info column */
  .rightPane {
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.12));
    border-radius:10px;padding:18px;border:1px solid rgba(0,255,102,0.02);
    min-height:520px;display:flex;flex-direction:column;gap:12px;
  }

  /* ===================================================================
     SECTION "PAGE" LAYOUT
     Each section fills the leftPane area and is shown/hidden by JS.
     We'll use CSS classes .section and .activeSection to animate transitions.
     =================================================================== */
  .section {
    position:absolute;inset:0;padding:20px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;
    transition: opacity .45s ease, transform .45s ease;
    opacity:0;transform: translateY(10px);pointer-events:none;
  }
  .section.active { opacity:1; transform: translateY(0); pointer-events:auto; }

  /* ===================================================================
     LOADER SECTION
     Circular spinner + progress bar + percentage + rotating tips + ETA
     =================================================================== */
  .spinner {
    width:120px;height:120px;border-radius:50%;
    background: linear-gradient(180deg, rgba(0,0,0,0.48), rgba(255,255,255,0.02));
    border: 4px solid rgba(255,255,255,0.02);
    display:grid;place-items:center;font-weight:800;color:var(--neon);
    box-shadow: var(--glow-strong);
    position:relative;
  }
  .spinner:after {
    content:"";position:absolute;inset:18px;border-radius:50%;border:8px solid rgba(0,0,0,0.6);border-top-color:var(--neon);
    animation: spin 0.95s linear infinite;
  }
  @keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}

  .progressWrap { width: 88%; display:flex;flex-direction:column;gap:10px;align-items:center }
  .barOuter { width:100%;height:18px;border-radius:12px;padding:3px;background:linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.007));border:1px solid rgba(0,255,102,0.02) }
  .barInner { width:0%;height:100%;border-radius:8px;background:linear-gradient(90deg, rgba(0,255,102,0.95), rgba(0,160,80,0.96));box-shadow:0 8px 30px rgba(0,255,102,0.06);transition:width .09s linear; }

  .percentLarge { font-size:22px;font-weight:900;color:var(--neon);text-shadow:0 0 6px rgba(0,255,102,0.09) }
  .tipSmall { font-size:13px;font-style:italic;color:rgba(0,255,102,0.94) }
  .etaSmall { font-size:12px;color:rgba(0,255,102,0.26) }

  /* ===================================================================
     CONNECTED SECTION
     Checkmark, animated wifi bars, short text
     =================================================================== */
  .check { font-size:64px;color:var(--neon);text-shadow:var(--glow-strong);animation: pulse 1.4s infinite; }
  @keyframes pulse {0%{transform:scale(1)}50%{transform:scale(1.12)}100%{transform:scale(1)}}

  .wifiBars { display:flex;align-items:flex-end;gap:8px }
  .wifiBars .bar{width:16px;border-radius:3px;background:var(--neon);box-shadow:var(--glow-soft);transform-origin:bottom center;animation:wave 1s ease-in-out infinite}
  .wifiBars .b1{height:12px;animation-delay:0s} .wifiBars .b2{height:20px;animation-delay:.12s} .wifiBars .b3{height:28px;animation-delay:.24s} .wifiBars .b4{height:36px;animation-delay:.36s}
  @keyframes wave{0%,100%{transform:scaleY(1)}50%{transform:scaleY(1.33)}}

  .connectedHeadline { font-size:20px;font-weight:900;color:var(--neon);text-shadow:var(--glow-strong) }
  .connectedSub { font-size:13px;color:rgba(0,255,102,0.7) }

  /* ===================================================================
     CONFIRM SECTION
     Displays the randomized IP and speed, has Yes/No buttons
     =================================================================== */
  .confirmCard { width:86%;padding:12px;border-radius:10px;background:linear-gradient(180deg, rgba(0,255,102,0.01), rgba(255,255,255,0.01));border:1px solid rgba(0,255,102,0.03);display:flex;flex-direction:column;gap:10px;align-items:center }
  .ipBig { font-weight:900;font-size:20px;color:var(--neon) }
  .speedSmall { font-size:13px;color:rgba(0,255,102,0.78) }
  .confirmRow { display:flex;gap:12px;margin-top:8px }
  .btnPrimary { padding:10px 16px;border-radius:10px;border:1px solid rgba(0,255,102,0.06);background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.14));color:var(--neon);font-weight:900;cursor:pointer; }
  .btnPrimary:active{transform:translateY(1px)} .btnSecondary{opacity:0.92}

  /* ===================================================================
     UPLOADING SECTION
     Upload progress with states + optional cancel
     =================================================================== */
  .uploadTitle { font-weight:900;color:var(--neon) }
  .uploadSub { color:rgba(0,255,102,0.7);font-size:13px }
  .uploadWrap { width:86%;display:flex;flex-direction:column;gap:10px;align-items:center }
  .uploadOuter{width:100%;padding:6px;border-radius:12px;background: rgba(255,255,255,0.01);border:1px solid rgba(0,255,102,0.03)}
  .uploadInner{width:0%;height:14px;border-radius:8px;background:linear-gradient(90deg, rgba(0,255,102,0.95), rgba(0,160,80,0.9));transition:width .08s linear;box-shadow:var(--glow-soft)}
  .uploadState {font-weight:800;color:var(--neon);font-size:13px}
  .cancelBtn { padding:8px 12px;border-radius:8px;background:transparent;border:1px solid rgba(0,255,102,0.06);color:var(--neon);cursor:pointer }

  /* ===================================================================
     SUCCESS SECTION & WORLD SVG
     - server name above the map
     - SVG map: rectangle representing long/lat mapped to coords,
       clipped to a circular "globe" effect
     - markers will be appended by JS
     =================================================================== */
  .successTitle { font-size:22px;font-weight:900;color:var(--neon);text-shadow:var(--glow-strong) }
  .serverName { font-size:18px;font-weight:800;color:var(--neon); margin-top:6px }
  .mapContainer { width:88%;max-width:880px;padding:10px;border-radius:10px;background:linear-gradient(180deg, rgba(0,0,0,0.36), rgba(255,255,255,0.003));border:1px solid rgba(0,255,102,0.03) }

  /* marker and pulse styles applied inside svg via class names (JS uses these names) */
  .markerDot { fill: var(--neon); stroke: rgba(0,0,0,0.35); stroke-width:1.2; }
  .pulseCircle { fill: rgba(0,255,102,0.12) }

  .mapHint { color:rgba(0,255,102,0.6); font-size:13px; margin-top:8px }
  .footerTiny { color: rgba(0,255,102,0.12); font-size:12px; margin-top:6px }

  /* ===================================================================
     Utility classes and responsiveness
     =================================================================== */
  .hidden { display:none !important; }
  @media (max-width:980px){ .main{grid-template-columns:1fr;}.rightPane{order:2}.leftPane{order:1} }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Cyber Network Flow Simulator">
    <div class="bg-grid" aria-hidden="true"></div>
    <div class="bg-rad" aria-hidden="true"></div>

    <!-- TOPBAR -->
    <div class="topbar" role="banner">
      <div class="brand"><div class="logo">GD</div> GearDriven Network UI</div>
      <div class="mutedSmall">Interactive demo — press Y/N on confirm • C cycles server on success • R restarts</div>
    </div>

    <!-- MAIN GRID -->
    <div class="main" role="main">

      <!-- LEFT: big visual area (sections live here) -->
      <div class="leftPane" aria-live="polite">

        <!-- ========== LOADER SECTION ========== -->
        <div id="sec-loader" class="section active" aria-label="Loading screen">
          <div class="spinner" role="img" aria-label="Loading spinner"><div style="font-size:12px;color:var(--neon)">CONNECT</div></div>

          <div class="progressWrap">
            <div class="barOuter"><div id="barInner" class="barInner" style="width:0%"></div></div>
            <div class="percentLarge" id="percentText">0%</div>
            <div class="tipSmall" id="tipText">Initializing connection...</div>
            <div class="etaSmall" id="etaText">ETA: 10s</div>
          </div>
        </div>

        <!-- ========== CONNECTED SECTION ========== -->
        <div id="sec-connected" class="section" aria-label="WiFi connected screen">
          <div class="check">✔</div>
          <div class="wifiBars" aria-hidden="true">
            <div class="bar b1"></div><div class="bar b2"></div><div class="bar b3"></div><div class="bar b4"></div>
          </div>
          <div class="connectedHeadline">WiFi Connected</div>
          <div class="connectedSub">Validated — preparing details...</div>
        </div>

        <!-- ========== CONFIRM SECTION ========== -->
        <div id="sec-confirm" class="section" aria-label="Confirm IP and speed">
          <div class="confirmCard" role="region" aria-label="Confirm connection card">
            <div class="ipBig" id="ipText">192.168.0.101</div>
            <div class="speedSmall" id="speedText">200 Mbps</div>
            <div style="width:100%;display:flex;justify-content:center;">
              <div class="confirmRow">
                <button id="btnYes" class="btnPrimary" aria-pressed="false">YES — Confirm</button>
                <button id="btnNo" class="btnPrimary btnSecondary" aria-pressed="false">NO — Retry</button>
              </div>
            </div>

            <div style="font-size:12px;color:rgba(0,255,102,0.28)">Tip: press Y for Yes, N for No</div>
          </div>
        </div>

        <!-- ========== UPLOADING SECTION ========== -->
        <div id="sec-upload" class="section" aria-label="Uploading to servers">
          <div class="uploadWrap">
            <div class="uploadTitle">Uploading to servers</div>
            <div class="uploadSub">Secure transfer in progress — do not close</div>

            <div class="uploadWrap">
              <div class="uploadOuter"><div id="uploadInner" class="uploadInner" style="width:0%"></div></div>
              <div style="width:86%;display:flex;justify-content:space-between"><div id="uploadState" class="uploadState">Starting upload...</div><div id="uploadPct" style="color:var(--neon)">0%</div></div>
              <div><button id="cancelBtn" class="cancelBtn">CANCEL & RESTART</button></div>
            </div>
          </div>
        </div>

        <!-- ========== SUCCESS SECTION ========== -->
        <div id="sec-success" class="section" aria-label="Upload successful and server map">
          <div style="display:flex;flex-direction:column;align-items:center;gap:6px">
            <div class="successTitle">Upload Successful</div>
            <div class="serverName" id="serverName">Server: —</div>
          </div>

          <!-- world map SVG: equirectangular rectangle clipped to a circle -->
          <div class="mapContainer" aria-hidden="false">
            <svg id="worldSVG" viewBox="0 0 900 450" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet">
              <defs>
                <clipPath id="globeClip"><circle cx="450" cy="225" r="200" /></clipPath>
                <radialGradient id="ocean" cx="50%" cy="40%"><stop offset="0%" stop-color="#021005" stop-opacity="0.55"/><stop offset="100%" stop-color="#001400" stop-opacity="0.92"/></radialGradient>
                <pattern id="grid" width="36" height="36" patternUnits="userSpaceOnUse"><path d="M0 0 L36 0" stroke="rgba(0,255,102,0.04)" stroke-width="0.8"/><path d="M0 0 L0 36" stroke="rgba(0,255,102,0.04)" stroke-width="0.8"/></pattern>
                <filter id="markerShadow" x="-50%" y="-50%" width="200%" height="200%"><feDropShadow dx="0" dy="6" stdDeviation="10" flood-color="rgba(0,255,102,0.08)"/></filter>
              </defs>

              <!-- circular backdrop -->
              <circle cx="450" cy="225" r="205" fill="rgba(0,0,0,0.45)" stroke="rgba(0,255,102,0.05)" stroke-width="2" />

              <g clip-path="url(#globeClip)">
                <!-- ocean rectangle for equirectangular mapping -->
                <rect x="50" y="50" width="800" height="300" fill="url(#ocean)"></rect>

                <!-- faint lat/lon grid -->
                <rect x="50" y="50" width="800" height="300" fill="url(#grid)" opacity="0.12"></rect>

                <!-- equator & prime meridian -->
                <path d="M50 200 L850 200" stroke="rgba(0,255,102,0.06)" stroke-width="1.2"/>
                <path d="M450 50 L450 350" stroke="rgba(0,255,102,0.06)" stroke-width="1.2"/>

                <!-- stylized continent blobs (for visual reference, not accurate coastlines) -->
                <g fill="rgba(0,0,0,0.18)" stroke="rgba(0,255,102,0.03)">
                  <path d="M120 170 C150 140 220 120 300 130 C360 135 390 160 420 170 C460 183 520 190 570 170 C630 150 700 150 740 170 L740 260 C680 240 620 250 560 260 C500 270 430 260 370 260 C300 260 220 250 160 240 Z" opacity="0.28"/>
                  <path d="M170 220 C185 200 220 200 260 210 C295 218 325 235 360 240 C380 244 330 260 300 260 C260 260 210 250 180 245 Z" opacity="0.16"></path>
                  <path d="M520 120 C540 100 580 98 620 110 C650 120 680 140 720 148 L740 150 L740 170" opacity="0.1"></path>
                  <path d="M280 300 C320 290 360 300 400 310 C460 325 520 330 590 320 C620 315 680 310 740 300 L740 260 C700 270 660 274 620 274 C560 274 520 268 480 260 C430 250 380 245 320 250 C280 254 250 272 220 282 Z" opacity="0.12"></path>
                </g>

                <!-- markers group (populated by JS) -->
                <g id="markers"></g>

              </g>

              <!-- thin outer ring -->
              <circle cx="450" cy="225" r="202" fill="none" stroke="rgba(0,255,102,0.04)" stroke-width="1.2"/>
            </svg>
          </div>

          <div class="mapHint">Highlighted marker shows server city. Press C to cycle servers. Press R to restart.</div>
          <div class="footerTiny">Map is stylized for demo purposes.</div>
        </div>

      </div><!-- end leftPane -->

      <!-- RIGHT: minimal control/info area; content changes based on stage -->
      <div class="rightPane" aria-hidden="false">

        <!-- This right column will show context-sensitive info. We keep a few placeholders
             and update them from JavaScript so the right column doesn't show "steps". -->

        <div id="infoConnect" style="display:block">
          <div style="font-weight:900;color:var(--neon)">Connecting…</div>
          <div style="color:rgba(0,255,102,0.6);margin-top:6px">Automatic network detection in progress. Please wait.</div>
        </div>

        <div id="infoConfirm" style="display:none">
          <div style="font-weight:900;color:var(--neon)">Confirm connection</div>
          <div style="color:rgba(0,255,102,0.6);margin-top:6px">Verify the IP and speed assigned to this device.</div>
        </div>

        <div id="infoUpload" style="display:none">
          <div style="font-weight:900;color:var(--neon)">Uploading</div>
          <div id="uploadShort" style="color:rgba(0,255,102,0.6);margin-top:6px">Preparing secure channel...</div>
        </div>

        <div id="infoSuccess" style="display:none">
          <div style="font-weight:900;color:var(--neon)">Complete</div>
          <div id="successShort" style="color:rgba(0,255,102,0.6);margin-top:6px">Upload successful. Server selected.</div>
        </div>

        <!-- small spacer -->
        <div style="flex:1"></div>

        <!-- quick controls duplicate for convenience -->
        <div style="display:flex;gap:8px;justify-content:center">
          <button id="restartBtn" class="btnPrimary">Restart</button>
          <button id="copyIpBtn" class="btnPrimary btnSecondary">Copy IP</button>
        </div>

      </div><!-- end rightPane -->

    </div><!-- end main -->
  </div><!-- end app -->

  <!-- ===========================
       JavaScript: Behavior & Flow
       =========================== -->
  <script>
  /* ============================================================
     This script manages the entire multi-section flow inside this
     single page. Sections are:
       - sec-loader
       - sec-connected
       - sec-confirm
       - sec-upload
       - sec-success

     Timing constraints enforced:
       - Loader = 10 seconds exactly (100 steps @ 100ms)
       - Connected screen = ~2.2 seconds
       - Upload simulated = ~5 seconds (100 steps @ 50ms)

     Map:
       - 40 cities with lat/lon
       - equirectangular mapping used to turn lon/lat -> x,y
         (x = left + (lon+180)/360 * width; y = top + (90-lat)/180 * height)
  ============================================================ */

  /* -----------------------
     DOM references
  ------------------------ */
  const sections = {
    loader: document.getElementById('sec-loader'),
    connected: document.getElementById('sec-connected'),
    confirm: document.getElementById('sec-confirm'),
    upload: document.getElementById('sec-upload'),
    success: document.getElementById('sec-success')
  };

  const barInner = document.getElementById('barInner');
  const percentText = document.getElementById('percentText');
  const tipText = document.getElementById('tipText');
  const etaText = document.getElementById('etaText');

  const ipText = document.getElementById('ipText');
  const speedText = document.getElementById('speedText');
  const btnYes = document.getElementById('btnYes');
  const btnNo = document.getElementById('btnNo');

  const uploadInner = document.getElementById('uploadInner');
  const uploadPct = document.getElementById('uploadPct');
  const uploadState = document.getElementById('uploadState');
  const cancelBtn = document.getElementById('cancelBtn');

  const serverName = document.getElementById('serverName');
  const markersGroup = document.getElementById('markers');
  const worldSVG = document.getElementById('worldSVG');

  const infoConnect = document.getElementById('infoConnect');
  const infoConfirm = document.getElementById('infoConfirm');
  const infoUpload = document.getElementById('infoUpload');
  const infoSuccess = document.getElementById('infoSuccess');

  const restartBtn = document.getElementById('restartBtn');
  const copyIpBtn = document.getElementById('copyIpBtn');

  /* -----------------------
     State & timers
  ------------------------ */
  let loaderTimer = null;
  let tipTimer = null;
  let uploadTimer = null;
  let uploadStateTimer = null;

  let loaderPercent = 0;
  let currentIP = '';
  let currentSpeed = '';
  let selectedServerIdx = -1;

  /* -----------------------
     Tip messages
  ------------------------ */
  const tipMessages = [
    "Checking network interface...",
    "Scanning for nearby SSIDs...",
    "Decrypting handshake (simulated)...",
    "Pinging local gateway...",
    "Verifying DNS entries...",
    "Negotiating bandwidth parameters...",
    "Optimizing signal path...",
    "Applying regional settings...",
    "Refreshing ARP table...",
    "Finalizing network handshake..."
  ];

  /* -----------------------
     Server cities list (40 total)
     Each entry has: name, lat, lon
     7 US first, then global.
  ------------------------ */
  const serverCities = [
    {name:"New York, USA", lat:40.7128, lon:-74.0060},
    {name:"Los Angeles, USA", lat:34.0522, lon:-118.2437},
    {name:"Chicago, USA", lat:41.8781, lon:-87.6298},
    {name:"Houston, USA", lat:29.7604, lon:-95.3698},
    {name:"Phoenix, USA", lat:33.4484, lon:-112.0740},
    {name:"Philadelphia, USA", lat:39.9526, lon:-75.1652},
    {name:"San Francisco, USA", lat:37.7749, lon:-122.4194},

    {name:"Toronto, Canada", lat:43.6532, lon:-79.3832},
    {name:"Vancouver, Canada", lat:49.2827, lon:-123.1207},
    {name:"Mexico City, Mexico", lat:19.4326, lon:-99.1332},

    {name:"London, UK", lat:51.5074, lon:-0.1278},
    {name:"Manchester, UK", lat:53.4808, lon:-2.2426},
    {name:"Paris, France", lat:48.8566, lon:2.3522},
    {name:"Berlin, Germany", lat:52.52, lon:13.4050},
    {name:"Munich, Germany", lat:48.1351, lon:11.5820},
    {name:"Madrid, Spain", lat:40.4168, lon:-3.7038},
    {name:"Rome, Italy", lat:41.9028, lon:12.4964},
    {name:"Amsterdam, Netherlands", lat:52.3676, lon:4.9041},
    {name:"Brussels, Belgium", lat:50.8503, lon:4.3517},
    {name:"Zurich, Switzerland", lat:47.3769, lon:8.5417},

    {name:"Vienna, Austria", lat:48.2082, lon:16.3738},
    {name:"Stockholm, Sweden", lat:59.3293, lon:18.0686},
    {name:"Oslo, Norway", lat:59.9139, lon:10.7522},
    {name:"Copenhagen, Denmark", lat:55.6761, lon:12.5683},
    {name:"Warsaw, Poland", lat:52.2297, lon:21.0122},

    {name:"Prague, Czech Republic", lat:50.0755, lon:14.4378},
    {name:"Budapest, Hungary", lat:47.4979, lon:19.0402},
    {name:"Athens, Greece", lat:37.9838, lon:23.7275},
    {name:"Istanbul, Turkey", lat:41.0082, lon:28.9784},

    {name:"Dubai, UAE", lat:25.2048, lon:55.2708},
    {name:"Doha, Qatar", lat:25.2854, lon:51.5310},

    {name:"Mumbai, India", lat:19.0760, lon:72.8777},
    {name:"Singapore", lat:1.3521, lon:103.8198},
    {name:"Hong Kong", lat:22.3193, lon:114.1694},

    {name:"Tokyo, Japan", lat:35.6762, lon:139.6503},
    {name:"Osaka, Japan", lat:34.6937, lon:135.5023},

    {name:"Sydney, Australia", lat:-33.8688, lon:151.2093},
    {name:"Melbourne, Australia", lat:-37.8136, lon:144.9631},
    {name:"Auckland, New Zealand", lat:-36.8485, lon:174.7633}
  ];

  /* -----------------------
     Helpers: random integers and picking
  ------------------------ */
  function randInt(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }
  function pickRandom(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

  /* -----------------------
     IP and speed generators
     - IP uses 192.168.x.y range for realistic private IPs
  ------------------------ */
  function genRandomIP(){
    const a = 192, b = 168;
    const c = randInt(0,255);
    const d = randInt(1,254);
    return `${a}.${b}.${c}.${d}`;
  }
  function genRandomSpeed(){
    const choices = [50,75,100,150,200,250,300,400,500,750,1000];
    return `${choices[randInt(0,choices.length-1)]} Mbps`;
  }

  /* -----------------------
     Section helpers: show/hide with animation
  ------------------------ */
  function showSection(name){
    Object.keys(sections).forEach(k=>{
      const el = sections[k];
      if(k===name){ el.classList.add('active'); el.style.display = 'flex'; }
      else { el.classList.remove('active'); el.style.display = 'none'; }
    });

    // also toggle right column informational panels
    infoConnect.style.display = (name==='loader') ? 'block' : 'none';
    infoConfirm.style.display = (name==='confirm') ? 'block' : 'none';
    infoUpload.style.display = (name==='upload') ? 'block' : 'none';
    infoSuccess.style.display = (name==='success') ? 'block' : 'none';
  }

  /* -----------------------
     MARKER & MAP MATH
     The SVG uses rectangle x=50..850 (width 800) and y=50..350 (height 300)
     Map conversion (equirectangular):
       x = left + (lon + 180) / 360 * width
       y = top + (90 - lat) / 180 * height
  ------------------------ */
  const MAP = {left:50, top:50, width:800, height:300};

  function lonLatToXY(lon, lat){
    const x = MAP.left + ((lon + 180) / 360) * MAP.width;
    const y = MAP.top + ((90 - lat) / 180) * MAP.height;
    return { x, y };
  }

  /* -----------------------
     Marker creation: create SVG groups for all cities
     Each group has:
       - pulse circle (larger, fades)
       - dot circle (solid)
       - optional label background + text (hidden by default)
  ------------------------ */
  function createMarkers(){
    markersGroup.innerHTML = ''; // clear any existing
    serverCities.forEach((city, idx)=>{
      const {x,y} = lonLatToXY(city.lon, city.lat);
      const ns = "http://www.w3.org/2000/svg";

      const g = document.createElementNS(ns, 'g');
      g.setAttribute('transform', `translate(${x}, ${y})`);
      g.setAttribute('data-idx', idx);
      g.style.cursor = 'pointer';

      const pulse = document.createElementNS(ns, 'circle');
      pulse.setAttribute('r', 12);
      pulse.setAttribute('class', 'pulseCircle');
      pulse.setAttribute('opacity', '0.9');

      const dot = document.createElementNS(ns, 'circle');
      dot.setAttribute('r', 5);
      dot.setAttribute('class', 'markerDot');
      dot.setAttribute('filter', 'url(#markerShadow)');

      // label background
      const rect = document.createElementNS(ns, 'rect');
      rect.setAttribute('x', 16); rect.setAttribute('y', -12); rect.setAttribute('width', 180); rect.setAttribute('height', 24);
      rect.setAttribute('rx', 6); rect.setAttribute('ry', 6);
      rect.setAttribute('fill', 'rgba(0,0,0,0.7)');
      rect.setAttribute('stroke', 'rgba(0,255,102,0.04)');
      rect.setAttribute('visibility', 'hidden');

      const text = document.createElementNS(ns, 'text');
      text.setAttribute('x', 24); text.setAttribute('y', 6); text.setAttribute('fill', 'var(--neon)');
      text.setAttribute('font-size', '12px'); text.setAttribute('visibility','hidden');
      text.textContent = city.name;

      // mouse events on group to show label
      g.addEventListener('mouseenter', ()=>{ rect.setAttribute('visibility','visible'); text.setAttribute('visibility','visible'); });
      g.addEventListener('mouseleave', ()=>{ rect.setAttribute('visibility','hidden'); text.setAttribute('visibility','hidden'); });

      // click to select server
      g.addEventListener('click', ()=>{ selectServer(parseInt(g.getAttribute('data-idx'))); });

      g.appendChild(pulse); g.appendChild(dot); g.appendChild(rect); g.appendChild(text);
      markersGroup.appendChild(g);
    });
  }

  /* -----------------------
     Highlight selected server marker (visual emphasis)
  ------------------------ */
  function highlightMarker(idx){
    const groups = markersGroup.querySelectorAll('g');
    groups.forEach(g=>{
      const dot = g.querySelector('circle.markerDot');
      const pulse = g.querySelector('circle.pulseCircle');
      if(dot) dot.setAttribute('r', '5');
      if(pulse) pulse.setAttribute('r', '12');
    });

    const target = markersGroup.querySelector(`g[data-idx="${idx}"]`);
    if(!target) return;
    const dot = target.querySelector('circle.markerDot');
    const pulse = target.querySelector('circle.pulseCircle');
    if(dot) dot.setAttribute('r', '7');
    if(pulse) pulse.setAttribute('r', '16');
    // reveal its label briefly
    const rect = target.querySelector('rect');
    const txt = target.querySelector('text');
    if(rect && txt){ rect.setAttribute('visibility','visible'); txt.setAttribute('visibility','visible'); setTimeout(()=>{ rect.setAttribute('visibility','hidden'); txt.setAttribute('visibility','hidden'); }, 2800); }
  }

  /* -----------------------
     Flow: start loader (10s)
  ------------------------ */
  function startLoader(){
    // clear any previous timers
    if(loaderTimer) clearInterval(loaderTimer);
    if(tipTimer) clearInterval(tipTimer);

    // reveal loader section
    showSection('loader');

    // reset state
    loaderPercent = 0;
    barInner.style.width = '0%';
    percentText.textContent = '0%';
    etaText.textContent = 'ETA: 10s';
    tipText.textContent = 'Initializing connection...';

    // choose ip and speed for this run
    currentIP = genRandomIP();
    currentSpeed = genRandomSpeed();
    ipText.textContent = currentIP;
    speedText.textContent = currentSpeed;

    // rotate tips every 1s
    let tipIdx = 0;
    tipTimer = setInterval(()=>{
      tipText.textContent = tipMessages[tipIdx % tipMessages.length];
      tipIdx++;
    }, 1000);

    // progress: 100 steps @ 100ms = 10s
    loaderTimer = setInterval(()=>{
      loaderPercent++;
      if(loaderPercent>100) loaderPercent = 100;
      barInner.style.width = loaderPercent + '%';
      percentText.textContent = loaderPercent + '%';
      // ETA display
      const remaining = Math.max(0, Math.ceil((100-loaderPercent)/10));
      etaText.textContent = `ETA: ${remaining}s`;

      if(loaderPercent >= 100){
        clearInterval(loaderTimer); loaderTimer = null;
        clearInterval(tipTimer); tipTimer = null;
        setTimeout(()=> showConnected(), 200); // small breath
      }
    }, 100);
  }

  /* -----------------------
     Show connected briefly (~2.2s), then show confirm
  ------------------------ */
  function showConnected(){
    showSection('connected');
    setTimeout(()=> showConfirm(), 2200);
  }

  /* -----------------------
     Show confirm screen
  ------------------------ */
  function showConfirm(){
    showSection('confirm');
    // ensure right column shows confirm info
    infoConnect.style.display = 'none';
    infoConfirm.style.display = 'block';
    infoUpload.style.display = 'none';
    infoSuccess.style.display = 'none';

    // ensure yes button focused for quick keyboard entry
    setTimeout(()=> btnYes.focus(), 40);
  }

  /* -----------------------
     Confirm handlers: yes (upload) / no (restart)
  ------------------------ */
  btnYes.addEventListener('click', ()=> { btnYes.setAttribute('aria-pressed','true'); btnNo.setAttribute('aria-pressed','false'); startUpload(); });
  btnNo.addEventListener('click', ()=> { btnNo.setAttribute('aria-pressed','true'); btnYes.setAttribute('aria-pressed','false'); restartFlow(); });

  /* Keyboard shortcuts when confirm visible */
  document.addEventListener('keydown', (e)=>{
    if(sections.confirm.classList.contains('active')){
      if(e.key==='y' || e.key==='Y' || e.key==='Enter'){ btnYes.click(); }
      if(e.key==='n' || e.key==='N' || e.key==='Escape'){ btnNo.click(); }
    }

    // when success map visible, handle cycle / restart
    if(sections.success.classList.contains('active')){
      if(e.key==='c' || e.key==='C'){ cycleServer(); }
      if(e.key==='r' || e.key==='R'){ restartFlow(); }
    }
  });

  /* -----------------------
     Start upload simulation (~5s)
  ------------------------ */
  function startUpload(){
    showSection('upload');
    infoConnect.style.display = 'none';
    infoConfirm.style.display = 'none';
    infoUpload.style.display = 'block';
    infoSuccess.style.display = 'none';

    // reset
    if(uploadTimer) clearInterval(uploadTimer);
    if(uploadStateTimer) clearInterval(uploadStateTimer);
    uploadInner.style.width = '0%'; uploadPct.textContent = '0%'; uploadState.textContent = 'Initializing secure channel...';
    document.getElementById('uploadInner').style.width = '0%';
    document.getElementById('uploadPct').textContent = '0%';

    // states shuffled across the upload
    const states = [
      "Initializing secure channel...",
      "Encrypting payload...",
      "Connecting to remote node...",
      "Transmitting packets...",
      "Verifying checksum...",
      "Finalizing transaction..."
    ];
    let st = 0;
    uploadStateTimer = setInterval(()=>{ st = Math.min(states.length-1, st+1); uploadState.textContent = states[st]; document.getElementById('uploadState').textContent = states[st]; }, 900);

    // simulate upload 100 steps @ 50ms = 5s
    let up = 0;
    uploadTimer = setInterval(()=>{
      up++; if(up>100) up=100;
      uploadInner.style.width = up + '%';
      uploadPct.textContent = up + '%';
      document.getElementById('uploadInner').style.width = up + '%';
      document.getElementById('uploadPct').textContent = up + '%';
      document.getElementById('uploadBarRight').style.width = up + '%';
      document.getElementById('uploadPctRight').textContent = up + '%';

      if(up>=100){
        clearInterval(uploadTimer); uploadTimer = null;
        clearInterval(uploadStateTimer); uploadStateTimer = null;
        setTimeout(()=> showSuccess(), 420);
      }
    }, 50);

    // cancel handler
    cancelBtn.onclick = ()=>{ if(uploadTimer) clearInterval(uploadTimer); if(uploadStateTimer) clearInterval(uploadStateTimer); restartFlow(); };
    document.getElementById('cancelUpload').onclick = cancelBtn.onclick;
    document.getElementById('cancelBtnRight').onclick = cancelBtn.onclick;
  }

  /* -----------------------
     On upload success, pick random server and show map
  ------------------------ */
  function showSuccess(){
    // choose a random server index
    selectedServerIdx = randInt(0, serverCities.length - 1);
    const city = serverCities[selectedServerIdx];
    serverName.textContent = `Server: ${city.name}`;

    // refresh markers visuals
    createMarkers(); // ensure markers exist
    highlightMarker(selectedServerIdx);

    showSection('success');
    infoConnect.style.display = 'none';
    infoConfirm.style.display = 'none';
    infoUpload.style.display = 'none';
    infoSuccess.style.display = 'block';
  }

  /* -----------------------
     select server via index (used by clicking markers)
  ------------------------ */
  function selectServer(idx){
    selectedServerIdx = idx;
    const city = serverCities[idx];
    serverName.textContent = `Server: ${city.name}`;
    highlightMarker(idx);
  }

  /* -----------------------
     cycle server on success (C key)
  ------------------------ */
  function cycleServer(){
    if(selectedServerIdx === -1) selectedServerIdx = 0;
    else selectedServerIdx = (selectedServerIdx + 1) % serverCities.length;
    selectServer(selectedServerIdx);
  }

  /* -----------------------
     restart flow (back to loader, new ip)
  ------------------------ */
  function restartFlow(){
    // clear timers
    if(loaderTimer) { clearInterval(loaderTimer); loaderTimer=null; }
    if(tipTimer) { clearInterval(tipTimer); tipTimer=null; }
    if(uploadTimer) { clearInterval(uploadTimer); uploadTimer=null; }
    if(uploadStateTimer) { clearInterval(uploadStateTimer); uploadStateTimer=null; }

    // show loader section and re-run
    startLoader();
  }

  /* -----------------------
     Utility: copy IP to clipboard
  ------------------------ */
  copyIpBtn.addEventListener('click', ()=>{
    if(!currentIP) return;
    navigator.clipboard?.writeText(currentIP).then(()=> {
      copyIpBtn.textContent = 'Copied!';
      setTimeout(()=> copyIpBtn.textContent = 'Copy IP', 1400);
    }).catch(()=> {
      copyIpBtn.textContent = 'Copy Unavailable';
      setTimeout(()=> copyIpBtn.textContent = 'Copy IP', 1400);
    });
  });

  /* -----------------------
     Restart button
  ------------------------ */
  restartBtn.addEventListener('click', ()=> { restartFlow(); });

  /* -----------------------
     Create markers in the map one time on load
  ------------------------ */
  createMarkers();

  /* -----------------------
     Auto-start on load
  ------------------------ */
  window.addEventListener('load', ()=> {
    // small transition delay for polish
    setTimeout(()=> { startLoader(); }, 220);
  });

  /* -----------------------
     Expose for debugging in console if needed
  ------------------------ */
  window.__cyberFlow = {
    startLoader, showConnected, showConfirm, startUpload, showSuccess, createMarkers, cycleServer, restartFlow, serverCities
  };

  /* ============================================================
     End of script
     ============================================================ */
  </script>
</body>
</html>
